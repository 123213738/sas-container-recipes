version: "2"
settings:

  conductor:
    # The Conductor container does the heavy lifting, and provides a portable
    # Python runtime for building your target containers. It should be derived
    # from the same distribution as you're building your target containers with.
    base: centos:7

  vars_files:
  - everything.yml

  # Set the name of the project. Defaults to basename of the project directory.
  # For built services, concatenated with service name to form the built image name.
  project_name: "sas-viya"

services:
  httpproxy:
    from: "{{ BASEIMAGE }}:{{ BASETAG }}"
    roles:
    - httpproxy
    ports:
    - "80:80"
    - "443:443"
    entrypoint: ["/opt/sas/viya/home/bin/httpproxy-entrypoint.sh"]
    labels:
      sas.recipe.version: "{{ SAS_RECIPE_VERSION }}"
      sas.layer.httpproxy: "true"
    volumes:
    - static-content:/httpproxy
    dev_overrides:
      environment:
        - "SAS_DEBUG=1"
    deployment_overrides:
      resources:
        limits:
        - "memory=512Mi"
        requests:
        - "memory=10Mi"
      volumes:
        - "log=/opt/sas/viya/config/var/log"

  programming:
    from: "{{ BASEIMAGE }}:{{ BASETAG }}"
    roles:
    - tini
    - sas-java
    - programming
    - spawner-config
    - batchserver
    - connect-config
    - sas-studio-config
    ports:
    - "7080:7080"
    entrypoint: ["/usr/bin/tini", "--", "/opt/sas/viya/home/bin/programming-entrypoint.sh"]
    labels:
      sas.recipe.version: "{{ SAS_RECIPE_VERSION }}"
      sas.layer.programming: "true"
    deployment_overrides:
      resources:
        limits:
        - "memory=12000Mi"
        requests:
        - "memory=512Mi"
      secrets:
        - "SETINIT_TEXT_ENC=UFJPQyBTRVRJTklUIFJFTEVBU0U9J1YwMyc7CiBTSVRFSU5GTyBOQU1FPSd2YTE4dzMwJwogU0lURT03MDE4MDkzOCBPU05BTUU9J0xJTiBYNjQnIFJFQ1JFQVRFIFdBUk49NDUgR1JBQ0U9NDUKIEJJUlRIREFZPScyOUFVRzIwMTgnRCAgRVhQSVJFPScwNVNFUDIwMTknRCBQQVNTV09SRD01ODkxOTQ0NTA7CiBDUFUgTU9ERUw9JyAnIE1PRE5VTT0nICcgU0VSSUFMPScgJyBOQU1FPUNQVTAwMDsKIENQVSBNT0RFTD0nICcgTU9ETlVNPScgJyBTRVJJQUw9Jys5OTk5JyBOQU1FPUNQVTAwMTsKIENQVSBNT0RFTD0nICcgTU9ETlVNPScgJyBTRVJJQUw9Jys5OTk5JyBOQU1FPUNQVTAwMjsKIEVYUElSRSAnUFJPRE5VTTAwMCcgJzA1U0VQMjAxOSdEIC8gQ1BVPUNQVTAwMCBDUFUwMDEgCiBDUFUwMDI7CiBFWFBJUkUgJ1BST0ROVU0wOTQnICdQUk9ETlVNNTM4JyAnUFJPRE5VTTgyNicgJ1BST0ROVU04MjcnCiAnUFJPRE5VTTkyMScgJ1BST0ROVU05ODUnICdQUk9ETlVNMTAwMCcgJ1BST0ROVU0xMDU1JwogJ1BST0ROVU0xMjAwJyAnUFJPRE5VTTEyMzEnICdQUk9ETlVNMTIzOCcgJzA1U0VQMjAxOSdECiAvIENQVT1DUFUwMDA7CiBFWFBJUkUgJ1BST0ROVU05OTUnICcwNFNFUDIwMTknRCAvIENQVT1DUFUwMDA7CiBFWFBJUkUgJ1BST0ROVU0xMTQxJyAnMDVTRVAyMDE5J0QgLyBDUFU9Q1BVMDAxOwogRVhQSVJFICdQUk9ETlVNMTEwMCcgJ1BST0ROVU0xMTA3JyAnUFJPRE5VTTExMDgnICdQUk9ETlVNMTEwOScKICdQUk9ETlVNMTExMCcgJ1BST0ROVU0xMTEyJyAnUFJPRE5VTTExMTMnICdQUk9ETlVNMTExOScKICdQUk9ETlVNMTEyNycgJ1BST0ROVU0xMTI4JyAnUFJPRE5VTTExMjknICdQUk9ETlVNMTEzMScKICdQUk9ETlVNMTEzNicgJ1BST0ROVU0xMTM4JyAnUFJPRE5VTTExNDInICdQUk9ETlVNMTE0MycKICdQUk9ETlVNMTE1NScgJ1BST0ROVU0xMTU4JyAnUFJPRE5VTTExNTknICdQUk9ETlVNMTE4NicKICdQUk9ETlVNMTUxOScgJzA1U0VQMjAxOSdEIC8gQ1BVPUNQVTAwMjsKIFNBVkU7IFJVTjsKICpQUk9ETlVNMDAwID0gQkFTRSBCYXNlIFNBUzsKICpQUk9ETlVNMDk0ID0gU0VDVVJFQk5ETCBTQVMvU2VjdXJlOwogKlBST0ROVU0xMDAwID0gQ0FTIENsb3VkIEFuYWx5dGljIFNlcnZpY2VzIFNBUyBDbGllbnQ7CiAqUFJPRE5VTTEwNTUgPSBGT1JFQ0FTVCBGb3JlY2FzdGluZyBQcm9jZWR1cmVzOwogKlBST0ROVU0xMTAwID0gQ1JTQUdHUkVHQVRFIEFjdGlvbiBTZXQgZm9yIEFnZ3JlZ2F0aW9uOwogKlBST0ROVU0xMTA3ID0gQ1JTRFMyIEFjdGlvbiBTZXQgZm9yIERTMjsKICpQUk9ETlVNMTEwOCA9IENSU0RUUkVFIEFjdGlvbiBTZXQgZm9yIERlY2lzaW9uIFRyZWU7CiAqUFJPRE5VTTExMDkgPSBDUlNGRURTUUwgQWN0aW9uIFNldCBmb3IgRkVEU1FMOwogKlBST0ROVU0xMTEwID0gQ1JTRk9SRUNBU1QgQWN0aW9uIFNldCBmb3IgU2ltcGxlIEZvcmVjYXN0czsKICpQUk9ETlVNMTExMiA9IENSU0xPQURTVFJNUyBBY3Rpb24gU2V0IGZvciBTdHJlYW1pbmcgRGF0YTsKICpQUk9ETlVNMTExMyA9IENSU01MUk5JTkcgQWN0aW9uIFNldCBmb3IgSHlwZXJncm91cHMgYW5kIEdyYXBoIGxheW91dDsKICpQUk9ETlVNMTExOSA9IENSU1BBUlNFIEFjdGlvbiBTZXQgZm9yIFBhcnNpbmcgYW5kIENhdGVnb3JpemF0aW9uOwogKlBST0ROVU0xMTI3ID0gQ1JTU0VBUkNIIEFjdGlvbiBTZXQgZm9yIFNlYXJjaDsKICpQUk9ETlVNMTEyOCA9IENSU1NFTlRJTUVOVCBBY3Rpb24gU2V0IGZvciBTZW50aW1lbnQgQW5hbHlzaXM7CiAqUFJPRE5VTTExMjkgPSBDUlNTRVFVRU5DRSBBY3Rpb24gU2V0IGZvciBTZXF1ZW5jZTsKICpQUk9ETlVNMTEzMSA9IENSU1NUQVQgQWN0aW9uIFNldCBmb3IgQ29tbW9uIENvZGU7CiAqUFJPRE5VTTExMzYgPSBDUlNUUkFOU1BPU0UgQWN0aW9uIFNldCBmb3IgVHJhbnNwb3NlOwogKlBST0ROVU0xMTM4ID0gQ1JTVFhUTUlOSU5HIEFjdGlvbiBTZXQgZm9yIFRleHQgTWluaW5nOwogKlBST0ROVU0xMTQxID0gVEtDQVMgU0FTIENsb3VkIEFuYWx5dGljIFNlcnZpY2VzIFNlcnZlcjsKICpQUk9ETlVNMTE0MiA9IENSU1JFQ09NTUVORCBBY3Rpb24gU2V0IGZvciBSZWNvbW1lbmRlcjsKICpQUk9ETlVNMTE0MyA9IENSU01UUFNSVkMgQWN0aW9uIFNldCBmb3IgTWlkdGllciBTZXJ2aWNlczsKICpQUk9ETlVNMTE1NSA9IENSU0FTVE9SRSBBY3Rpb24gU2V0IEFTVE9SRSBTY29yaW5nOwogKlBST0ROVU0xMTU4ID0gQ1JTTU9ERUxQVUIgQWN0aW9uIFNldCBNb2RlbCBQdWJsaXNoaW5nOwogKlBST0ROVU0xMTU5ID0gQ1JTU0dDT01QIEFjdGlvbiBTZXQgZm9yIFN0YXRpc3RpY2FsIEdyYXBoaWNzIENvbXB1dGF0OwogKlBST0ROVU0xMTg2ID0gQ1JTRkNNUEFDVCBBY3Rpb24gU2V0IGZvciBDb21waWxlciBhbmQgU3ltYm9saWMgRGlmZmVyOwogKlBST0ROVU0xMjAwID0gQ0RGQkFTRSBEYXRhIENvbm5lY3RvciBTQVMgRGF0YSBTZXRzOwogKlBST0ROVU0xMjMxID0gQ0RGV0VCIFdFQiBNZWRpYSBEYXRhIEZlZWRlcjsKICpQUk9ETlVNMTIzOCA9IENERlNQREUgRGF0YSBDb25uZWN0b3IgdG8gU1BERTsKICpQUk9ETlVNMTUxOSA9IENSU1BTRVVETyBDQVMgQWN0aW9uIFNldCBQU0VVRE8gTG9jYWw7CiAqUFJPRE5VTTUzOCA9IFdLU1BTUlZMT0NBTCBTQVMgV29ya3NwYWNlIFNlcnZlciBmb3IgTG9jYWwgQWNjZXNzOwogKlBST0ROVU04MjYgPSBCSUNFTlRSQUxNSUQgU0FTIEhvbWU7CiAqUFJPRE5VTTgyNyA9IEJJU1JWTUlEIFNBUyBWaXN1YWwgQW5hbHl0aWNzIFNlcnZpY2VzOwogKlBST0ROVU05MjEgPSBCSU1WQSBTQVMgVmlzdWFsIEFuYWx5dGljcyBTZXJ2ZXIgQ29tcG9uZW50czsKICpQUk9ETlVNOTg1ID0gU0FHRU1JRCBTQVMgVmlzdWFsIEFuYWx5dGljcyBFeHBsb3JlcjsKICpQUk9ETlVNOTk1ID0gU1BSRUVYQ0wxIFNQUkUgQmFzZTsKICpMSUNFTlNFPVNBUyAwMDAwNjMxNjgxNTk7CiAqMDA3OTM5MDAwMiBWMDMuMDA7CiAqWFlaIDY4NTY0NDsK"
      volumes:
        - "log=/opt/sas/viya/config/var/log"

  sas-casserver-primary:
    from: "{{ BASEIMAGE }}:{{ BASETAG }}"
    roles:
    - tini
    - sas-java
    - sas-casserver-primary
    ports:
    - "5570:5570"
    - "5571:5571"
    - "8777:8777"
    entrypoint: ["/usr/bin/tini", "--", "/opt/sas/viya/home/bin/sas-casserver-primary-entrypoint.sh"]
    labels:
      sas.recipe.version: "{{ SAS_RECIPE_VERSION }}"
      sas.layer.sas-casserver: "true"
    deployment_overrides:
      environment:
        - "SERVICE_NAME=cascontroller"
      resources:
        limits:
        - "memory=12000Mi"
        requests:
        - "memory=1024Mi"
      secrets:
        - "SETINIT_TEXT_ENC=UFJPQyBTRVRJTklUIFJFTEVBU0U9J1YwMyc7CiBTSVRFSU5GTyBOQU1FPSd2YTE4dzMwJwogU0lURT03MDE4MDkzOCBPU05BTUU9J0xJTiBYNjQnIFJFQ1JFQVRFIFdBUk49NDUgR1JBQ0U9NDUKIEJJUlRIREFZPScyOUFVRzIwMTgnRCAgRVhQSVJFPScwNVNFUDIwMTknRCBQQVNTV09SRD01ODkxOTQ0NTA7CiBDUFUgTU9ERUw9JyAnIE1PRE5VTT0nICcgU0VSSUFMPScgJyBOQU1FPUNQVTAwMDsKIENQVSBNT0RFTD0nICcgTU9ETlVNPScgJyBTRVJJQUw9Jys5OTk5JyBOQU1FPUNQVTAwMTsKIENQVSBNT0RFTD0nICcgTU9ETlVNPScgJyBTRVJJQUw9Jys5OTk5JyBOQU1FPUNQVTAwMjsKIEVYUElSRSAnUFJPRE5VTTAwMCcgJzA1U0VQMjAxOSdEIC8gQ1BVPUNQVTAwMCBDUFUwMDEgCiBDUFUwMDI7CiBFWFBJUkUgJ1BST0ROVU0wOTQnICdQUk9ETlVNNTM4JyAnUFJPRE5VTTgyNicgJ1BST0ROVU04MjcnCiAnUFJPRE5VTTkyMScgJ1BST0ROVU05ODUnICdQUk9ETlVNMTAwMCcgJ1BST0ROVU0xMDU1JwogJ1BST0ROVU0xMjAwJyAnUFJPRE5VTTEyMzEnICdQUk9ETlVNMTIzOCcgJzA1U0VQMjAxOSdECiAvIENQVT1DUFUwMDA7CiBFWFBJUkUgJ1BST0ROVU05OTUnICcwNFNFUDIwMTknRCAvIENQVT1DUFUwMDA7CiBFWFBJUkUgJ1BST0ROVU0xMTQxJyAnMDVTRVAyMDE5J0QgLyBDUFU9Q1BVMDAxOwogRVhQSVJFICdQUk9ETlVNMTEwMCcgJ1BST0ROVU0xMTA3JyAnUFJPRE5VTTExMDgnICdQUk9ETlVNMTEwOScKICdQUk9ETlVNMTExMCcgJ1BST0ROVU0xMTEyJyAnUFJPRE5VTTExMTMnICdQUk9ETlVNMTExOScKICdQUk9ETlVNMTEyNycgJ1BST0ROVU0xMTI4JyAnUFJPRE5VTTExMjknICdQUk9ETlVNMTEzMScKICdQUk9ETlVNMTEzNicgJ1BST0ROVU0xMTM4JyAnUFJPRE5VTTExNDInICdQUk9ETlVNMTE0MycKICdQUk9ETlVNMTE1NScgJ1BST0ROVU0xMTU4JyAnUFJPRE5VTTExNTknICdQUk9ETlVNMTE4NicKICdQUk9ETlVNMTUxOScgJzA1U0VQMjAxOSdEIC8gQ1BVPUNQVTAwMjsKIFNBVkU7IFJVTjsKICpQUk9ETlVNMDAwID0gQkFTRSBCYXNlIFNBUzsKICpQUk9ETlVNMDk0ID0gU0VDVVJFQk5ETCBTQVMvU2VjdXJlOwogKlBST0ROVU0xMDAwID0gQ0FTIENsb3VkIEFuYWx5dGljIFNlcnZpY2VzIFNBUyBDbGllbnQ7CiAqUFJPRE5VTTEwNTUgPSBGT1JFQ0FTVCBGb3JlY2FzdGluZyBQcm9jZWR1cmVzOwogKlBST0ROVU0xMTAwID0gQ1JTQUdHUkVHQVRFIEFjdGlvbiBTZXQgZm9yIEFnZ3JlZ2F0aW9uOwogKlBST0ROVU0xMTA3ID0gQ1JTRFMyIEFjdGlvbiBTZXQgZm9yIERTMjsKICpQUk9ETlVNMTEwOCA9IENSU0RUUkVFIEFjdGlvbiBTZXQgZm9yIERlY2lzaW9uIFRyZWU7CiAqUFJPRE5VTTExMDkgPSBDUlNGRURTUUwgQWN0aW9uIFNldCBmb3IgRkVEU1FMOwogKlBST0ROVU0xMTEwID0gQ1JTRk9SRUNBU1QgQWN0aW9uIFNldCBmb3IgU2ltcGxlIEZvcmVjYXN0czsKICpQUk9ETlVNMTExMiA9IENSU0xPQURTVFJNUyBBY3Rpb24gU2V0IGZvciBTdHJlYW1pbmcgRGF0YTsKICpQUk9ETlVNMTExMyA9IENSU01MUk5JTkcgQWN0aW9uIFNldCBmb3IgSHlwZXJncm91cHMgYW5kIEdyYXBoIGxheW91dDsKICpQUk9ETlVNMTExOSA9IENSU1BBUlNFIEFjdGlvbiBTZXQgZm9yIFBhcnNpbmcgYW5kIENhdGVnb3JpemF0aW9uOwogKlBST0ROVU0xMTI3ID0gQ1JTU0VBUkNIIEFjdGlvbiBTZXQgZm9yIFNlYXJjaDsKICpQUk9ETlVNMTEyOCA9IENSU1NFTlRJTUVOVCBBY3Rpb24gU2V0IGZvciBTZW50aW1lbnQgQW5hbHlzaXM7CiAqUFJPRE5VTTExMjkgPSBDUlNTRVFVRU5DRSBBY3Rpb24gU2V0IGZvciBTZXF1ZW5jZTsKICpQUk9ETlVNMTEzMSA9IENSU1NUQVQgQWN0aW9uIFNldCBmb3IgQ29tbW9uIENvZGU7CiAqUFJPRE5VTTExMzYgPSBDUlNUUkFOU1BPU0UgQWN0aW9uIFNldCBmb3IgVHJhbnNwb3NlOwogKlBST0ROVU0xMTM4ID0gQ1JTVFhUTUlOSU5HIEFjdGlvbiBTZXQgZm9yIFRleHQgTWluaW5nOwogKlBST0ROVU0xMTQxID0gVEtDQVMgU0FTIENsb3VkIEFuYWx5dGljIFNlcnZpY2VzIFNlcnZlcjsKICpQUk9ETlVNMTE0MiA9IENSU1JFQ09NTUVORCBBY3Rpb24gU2V0IGZvciBSZWNvbW1lbmRlcjsKICpQUk9ETlVNMTE0MyA9IENSU01UUFNSVkMgQWN0aW9uIFNldCBmb3IgTWlkdGllciBTZXJ2aWNlczsKICpQUk9ETlVNMTE1NSA9IENSU0FTVE9SRSBBY3Rpb24gU2V0IEFTVE9SRSBTY29yaW5nOwogKlBST0ROVU0xMTU4ID0gQ1JTTU9ERUxQVUIgQWN0aW9uIFNldCBNb2RlbCBQdWJsaXNoaW5nOwogKlBST0ROVU0xMTU5ID0gQ1JTU0dDT01QIEFjdGlvbiBTZXQgZm9yIFN0YXRpc3RpY2FsIEdyYXBoaWNzIENvbXB1dGF0OwogKlBST0ROVU0xMTg2ID0gQ1JTRkNNUEFDVCBBY3Rpb24gU2V0IGZvciBDb21waWxlciBhbmQgU3ltYm9saWMgRGlmZmVyOwogKlBST0ROVU0xMjAwID0gQ0RGQkFTRSBEYXRhIENvbm5lY3RvciBTQVMgRGF0YSBTZXRzOwogKlBST0ROVU0xMjMxID0gQ0RGV0VCIFdFQiBNZWRpYSBEYXRhIEZlZWRlcjsKICpQUk9ETlVNMTIzOCA9IENERlNQREUgRGF0YSBDb25uZWN0b3IgdG8gU1BERTsKICpQUk9ETlVNMTUxOSA9IENSU1BTRVVETyBDQVMgQWN0aW9uIFNldCBQU0VVRE8gTG9jYWw7CiAqUFJPRE5VTTUzOCA9IFdLU1BTUlZMT0NBTCBTQVMgV29ya3NwYWNlIFNlcnZlciBmb3IgTG9jYWwgQWNjZXNzOwogKlBST0ROVU04MjYgPSBCSUNFTlRSQUxNSUQgU0FTIEhvbWU7CiAqUFJPRE5VTTgyNyA9IEJJU1JWTUlEIFNBUyBWaXN1YWwgQW5hbHl0aWNzIFNlcnZpY2VzOwogKlBST0ROVU05MjEgPSBCSU1WQSBTQVMgVmlzdWFsIEFuYWx5dGljcyBTZXJ2ZXIgQ29tcG9uZW50czsKICpQUk9ETlVNOTg1ID0gU0FHRU1JRCBTQVMgVmlzdWFsIEFuYWx5dGljcyBFeHBsb3JlcjsKICpQUk9ETlVNOTk1ID0gU1BSRUVYQ0wxIFNQUkUgQmFzZTsKICpMSUNFTlNFPVNBUyAwMDAwNjMxNjgxNTk7CiAqMDA3OTM5MDAwMiBWMDMuMDA7CiAqWFlaIDY4NTY0NDsK"
        - "CASKEY=REPLACE ME with unique text. This is used to allow CAS workers to talk to the CAS controller"
      volumes:
        - "data=/cas/data"
        - "cache=/cas/cache"
        - "permstore=/cas/permstore"
        - "log=/opt/sas/viya/config/var/log"

registries:
  docker-registry:
    url: "localhost"
    namespace: "coguar"

volumes:
  static-content:
    docker: {}
